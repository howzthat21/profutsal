
<?php
include 'db.php';

session_start();

if (!isset($_SESSION['user_id'])) {
    header("Location: login.php");
    exit();
}

$player_id = $_SESSION['user_id'];

$fetch_match_sql = "SELECT mp.match_id, mp.user_id, u.username 
    FROM match_participants mp
    JOIN users u ON mp.user_id = u.id
    WHERE mp.match_id NOT IN (
        SELECT match_id FROM completed_matches
    ) AND mp.user_id = :player_id";
$fetch_match_stmt = $pdo->prepare($fetch_match_sql);
$fetch_match_stmt->execute(['player_id' => $player_id]);

$match = $fetch_match_stmt->fetch(PDO::FETCH_ASSOC);

$matchId=$match['match_id'];

$teamQuery = "
    SELECT 
        mp.team_name, 
        GROUP_CONCAT(u.username SEPARATOR ', ') AS team_members
    FROM 
        match_participants mp
    JOIN 
        users u ON mp.user_id = u.id
    WHERE 
        mp.match_id = :match_id
    GROUP BY 
        mp.team_name
";

// Prepare and execute the query
$teamStmt = $pdo->prepare($teamQuery);
$teamStmt->execute(['match_id' => $matchId]);

// Fetch the results
$teams = $teamStmt->fetchAll(PDO::FETCH_ASSOC);

// Display the teams and their members
foreach ($teams as $team) {
    echo "<h3>Team: " . htmlspecialchars($team['team_name']) . "</h3>";
    echo "<p>Members: " . htmlspecialchars($team['team_members']) . "</p>";
}


//fetching arena details to display
$fetch_arena_id="SELECT arena_id, booking_datetime from matchmaking where match_id= ?";
$fetch_arena_id_stmt=$pdo->prepare($fetch_arena_id);
$fetch_arena_id_stmt->execute([$matchId]);
$arena_details=$fetch_arena_id_stmt->fetch(PDO::FETCH_ASSOC);
$arena_id=$arena_details['arena_id'];
$booking_datetime=$arena_details['booking_datetime'];

//creating object for the date
 $date_object= new DateTime($booking_datetime);
 $formatted_date = $date_object->format('l, F j, Y g:i A');


$fetch_arena_details="SELECT * from arenas where arena_id= ?";
$fetch_arena_details_stmt=$pdo->prepare($fetch_arena_details);
$fetch_arena_details_stmt->execute([$arena_id]);
$arena_details=$fetch_arena_details_stmt->fetch(PDO::FETCH_ASSOC);
$arena_name=$arena_details['arena_name'];
$arena_location=$arena_details['arena_location'];
$arena_image=$arena_details['arena_image'];
$arena_contact_info=$arena_details['contact_info'];



//fet

if(!$match){
    header("Location: index.php");
}
$booking_datetimetry = "2024-11-21 14:30:00";
?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="futsalground.css">
  <title>Futsal Ground</title>
</head>
<body>
  <!-- Referee Section -->
  <div class="referee">
    Referee: John Doe | Referee ID: 12345
  </div>

  <!-- Header Section -->
  <div class="header">
    <h1>Match Lineups</h1>
    <p class="futsal-name">Futsal Name: Sunshine Futsal</p>
    <p class="location-time">Location: City Center</p>
    <p class="location-time">Date: 2024-11-23 | Time: 10:00 AM</p>
  </div>

  <!-- Futsal Ground -->
  <div class="container">
    <div class="line"></div>
    <div class="half"></div>
    <div class="panelty left"></div>
    <div class="panelty right"></div>
    <div class="p-spot left"></div>
    <div class="p-spot right"></div>
    <div class="center"></div>
    <div class="p-place left"></div>
    <div class="p-place right"></div>

    <!-- Team A Players -->
    <div class="player player1" style="top: 80px; left: 120px;">
      <div class="player-icon">1</div>
      <div class="player-name">Player 1</div>
    </div>
    <div class="player player2" style="top: 200px; left: 10px;">
      <div class="player-icon">2</div>
      <div class="player-name">Player 2</div>
    </div>
    <div class="player player3" style="top: 280px; left: 120px;">
      <div class="player-icon">3</div>
      <div class="player-name">Player 3</div>
    </div>
    <div class="player player4" style="top: 140px; left: 200px;">
      <div class="player-icon">4</div>
      <div class="player-name">Player 4</div>
    </div>
    <div class="player player5" style="top: 220px; left: 200px;">
      <div class="player-icon">5</div>
      <div class="player-name">Player 5</div>
    </div>

    <!-- Team B Players -->
    <div class="player player6" style="top: 80px; right: 120px;">
      <div class="player-icon">6</div>
      <div class="player-name">Player 6</div>
    </div>
    <div class="player player7" style="top: 200px; right: 10px;">
      <div class="player-icon">7</div>
      <div class="player-name">Player 7</div>
    </div>
    <div class="player player8" style="top: 280px; right: 120px;">
      <div class="player-icon">8</div>
      <div class="player-name">Player 8</div>
    </div>
    <div class="player player9" style="top: 140px; right: 200px;">
      <div class="player-icon">9</div>
      <div class="player-name">Player 9</div>
    </div>
    <div class="player player10" style="top: 220px; right: 200px;">
      <div class="player-icon">10</div>
      <div class="player-name">Player 10</div>
    </div>
  </div>

  <!-- Player Table Section -->
  <div class="table-container">
    <h2 class="table-title">5v5 Team Player Details</h2>
    <table class="player-table">
      <thead>
        <tr>
          <th>Position</th>
          <th>Team A</th>
          <th>Team B</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Goalkeeper</td>
          <td>Player 1</td>
          <td>Player 6</td>
        </tr>
        <tr>
          <td>Defender</td>
          <td>Player 2</td>
          <td>Player 7</td>
        </tr>
        <tr>
          <td>Midfielder</td>
          <td>Player 3</td>
          <td>Player 8</td>
        </tr>
        <tr>
          <td>Forward</td>
          <td>Player 4</td>
          <td>Player 9</td>
        </tr>
        <tr>
          <td>Forward</td>
          <td>Player 5</td>
          <td>Player 10</td>
        </tr>
      </tbody>
    </table>
  </div>
</body>
</html>
